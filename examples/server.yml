nodes:
  # ncat tcp server waiting for many connections
  - command: [ncat, -v, -l, -k, -p7000]
    inputs:
      - {fd: 0, name: send}
    outputs:
      - {fd: 2, name: log}
      - {fd: 1, name: received}

  # periodic echo of current date is sent to opened connections
  - command: [bash, -c, 'while true; do date; sleep 10; done']
    outputs:
      - {fd: 1, name: send}

  # log being saved to a file
  - command: [bash, -c, 'cat > logfile.txt']
    inputs:
      - {fd: 0, name: log}

  # incoming data is echoed back but also processed by our fancy machinery
  - command: [tee, /proc/self/fd/3]
    inputs:
      - {fd: 0, name: received}
    outputs:
      - {fd: 1, name: send}
      - {fd: 3, name: unfiltered_exprs}

  # pass only lines beginning with #
  - command: [sed, -rn, -u, 's/^#(.*)/\1/p']
    inputs:
      - {fd: 0, name: unfiltered_exprs}
    outputs:
      - {fd: 1, name: exprs}

  # evaluate expressions and send results
  - command: [xargs, -L1, expr]
    inputs:
      - {fd: 0, name: exprs}
    outputs:
      - {fd: 1, name: send}
      - {fd: 2, name: send}
